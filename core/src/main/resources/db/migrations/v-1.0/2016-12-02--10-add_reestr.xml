<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
                   http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet author="Ruslan Beyganov" id="2016-12-02--10-add_reestr" objectQuotingStrategy="LEGACY">
        <sql splitStatements="true">
            /************ Update: Schemas ***************/

            /* Add Schema: external */
            CREATE SCHEMA external;


            /************ Add: Sequences ***************/

            /* Autogenerated Sequences */

            CREATE SEQUENCE external.reestr_id_seq INCREMENT BY 1;
            COMMENT ON SEQUENCE external.reestr_id_seq IS 'DbWrench Autogenerated Sequence.';

            CREATE SEQUENCE external.reestr_head_id_seq INCREMENT BY 1;
            COMMENT ON SEQUENCE external.reestr_head_id_seq IS 'DbWrench Autogenerated Sequence.';




            /************ Update: Tables ***************/

            /******************** Add Table: external.reestr ************************/

            /* Build Table Structure */
            CREATE TABLE external.reestr
            (
            id BIGINT DEFAULT nextval('external.reestr_id_seq'::regclass) NOT NULL,
            reestr_head_id BIGINT NOT NULL,
            name VARCHAR(200) NOT NULL,
            firstname VARCHAR(200) NULL,
            surname VARCHAR(200) NULL,
            iin VARCHAR(20) NOT NULL,
            share_type VARCHAR(100) NULL,
            "NIN" VARCHAR(100) NULL,
            share_count INTEGER NOT NULL,
            share_percent FLOAT NOT NULL,
            all_share_count INTEGER NULL,
            email VARCHAR(100) NULL,
            phone VARCHAR(100) NULL
            );

            /* Add Primary Key */
            ALTER TABLE external.reestr ADD CONSTRAINT pkreestr
            PRIMARY KEY (id);

            /* Add Comments */
            COMMENT ON COLUMN external.reestr.reestr_head_id IS 'ID заголовка';

            COMMENT ON COLUMN external.reestr.name IS 'Наименование фамилия';

            COMMENT ON COLUMN external.reestr.firstname IS 'Имя';

            COMMENT ON COLUMN external.reestr.surname IS 'Отчество';

            COMMENT ON COLUMN external.reestr.iin IS 'ИИН/БИН';

            COMMENT ON COLUMN external.reestr.share_type IS 'Тип ЦБ';

            COMMENT ON COLUMN external.reestr."NIN" IS 'НИН';

            COMMENT ON COLUMN external.reestr.share_count IS 'Количество голосующих акции';

            COMMENT ON COLUMN external.reestr.share_percent IS 'Процент голосующих акции';

            COMMENT ON TABLE external.reestr IS 'Реестр';


            /******************** Add Table: external.reestr_head ************************/

            /* Build Table Structure */
            CREATE TABLE external.reestr_head
            (
            id BIGINT DEFAULT nextval('external.reestr_head_id_seq'::regclass) NOT NULL,
            iin VARCHAR(20) NOT NULL,
            org_name VARCHAR(200) NOT NULL,
            date_create TIMESTAMP NOT NULL,
            status VARCHAR(20) NULL
            );

            /* Add Primary Key */
            ALTER TABLE external.reestr_head ADD CONSTRAINT pkreestr_head
            PRIMARY KEY (id);

            /* Add Comments */
            COMMENT ON COLUMN external.reestr_head.iin IS 'БИН эмитента';

            COMMENT ON COLUMN external.reestr_head.org_name IS 'Наименование эмитента';

            COMMENT ON COLUMN external.reestr_head.date_create IS 'Дата формирования реестра';

            COMMENT ON COLUMN external.reestr_head.status IS 'Статус реестра NEW READY CLOSE';

            COMMENT ON TABLE external.reestr_head IS 'Заголовок реестра';





            /************ Add Foreign Keys ***************/

            /* Add Foreign Key: fk_reestr_reestr_head */
            ALTER TABLE external.reestr ADD CONSTRAINT fk_reestr_reestr_head
            FOREIGN KEY (reestr_head_id) REFERENCES external.reestr_head (id)
            ON UPDATE NO ACTION ON DELETE NO ACTION;
        </sql>
    </changeSet>
</databaseChangeLog>