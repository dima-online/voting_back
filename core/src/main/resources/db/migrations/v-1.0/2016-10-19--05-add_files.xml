<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
                   http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet author="Ruslan Beyganov" id="2016-10-19--04-edit_user_and_voter_fields" objectQuotingStrategy="LEGACY">
        <sql splitStatements="true">
            /* Autogenerated Sequences */

            CREATE SEQUENCE core.files_id_seq INCREMENT BY 1;
            COMMENT ON SEQUENCE core.files_id_seq IS 'DbWrench Autogenerated Sequence.';

            CREATE SEQUENCE core.question_file_id_seq INCREMENT BY 1;
            COMMENT ON SEQUENCE core.question_file_id_seq IS 'DbWrench Autogenerated Sequence.';

            /******************** Add Table: core.files ************************/

            /* Build Table Structure */
            CREATE TABLE core.files
            (
            id BIGINT DEFAULT nextval('core.files_id_seq'::regclass) NOT NULL,
            file_name VARCHAR(200) NOT NULL,
            file_path VARCHAR(500) NULL,
            voting_id BIGINT NOT NULL
            );

            /* Add Primary Key */
            ALTER TABLE core.files ADD CONSTRAINT pkfiles
            PRIMARY KEY (id);

            /* Add Comments */
            COMMENT ON COLUMN core.files.file_name IS 'Наименование файла';

            COMMENT ON COLUMN core.files.file_path IS 'Наименование файла на сервере';

            COMMENT ON COLUMN core.files.voting_id IS 'ID голосования';

            COMMENT ON TABLE core.files IS 'Материалы';


            /******************** Add Table: core.question_file ************************/

            /* Build Table Structure */
            CREATE TABLE core.question_file
            (
            id BIGINT DEFAULT nextval('core.question_file_id_seq'::regclass) NOT NULL,
            files_id BIGINT NOT NULL,
            question_id BIGINT NOT NULL
            );

            /* Add Primary Key */
            ALTER TABLE core.question_file ADD CONSTRAINT pkquestion_file
            PRIMARY KEY (id);

            /* Add Comments */
            COMMENT ON TABLE core.question_file IS 'Материалы вопроса';


            /************ Add Foreign Keys ***************/

            /* Add Foreign Key: fk_files_voting */
            ALTER TABLE core.files ADD CONSTRAINT fk_files_voting
            FOREIGN KEY (voting_id) REFERENCES core.voting (id)
            ON UPDATE NO ACTION ON DELETE NO ACTION;

            /* Add Foreign Key: fk_question_file_files */
            ALTER TABLE core.question_file ADD CONSTRAINT fk_question_file_files
            FOREIGN KEY (files_id) REFERENCES core.files (id)
            ON UPDATE NO ACTION ON DELETE NO ACTION;

            /* Add Foreign Key: fk_question_file_question */
            ALTER TABLE core.question_file ADD CONSTRAINT fk_question_file_question
            FOREIGN KEY (question_id) REFERENCES core.question (id)
            ON UPDATE NO ACTION ON DELETE NO ACTION;
        </sql>
    </changeSet>
</databaseChangeLog>